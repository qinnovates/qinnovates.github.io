---
import BaseLayout from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import TrustBar from '../components/TrustBar.astro';
import PublicationCard from '../components/PublicationCard.astro';
import { getCollection } from 'astro:content';
import { getPostDate } from '../lib/utils';
import { HOURGLASS_BANDS, STATS, PILLARS } from '../lib/qif-constants';
import HeroParticles from '../components/HeroParticles';
import '../styles/global.css';

const posts = (await getCollection('blog'))
  .sort((a, b) => new Date(getPostDate(b.data)).getTime() - new Date(getPostDate(a.data)).getTime())
  .slice(0, 4);

---

<BaseLayout title="Qinnovate — Securing the Neural Frontier" description="Qinnovate develops open standards and frameworks for brain-computer interface security. Home of the Quantum Indeterministic Framework (QIF).">
  <Nav />

  <!-- ═══ HERO ═══ -->
  <section class="relative min-h-screen flex flex-col items-center justify-center px-4 overflow-hidden">
    <!-- Gradient background -->
    <div class="absolute inset-0 bg-[var(--color-bg-deep)]">
      <div class="absolute inset-0 opacity-30" style="background: radial-gradient(ellipse at 50% 30%, rgba(59,130,246,0.15) 0%, transparent 60%), radial-gradient(ellipse at 30% 70%, rgba(6,182,212,0.1) 0%, transparent 50%), radial-gradient(ellipse at 70% 60%, rgba(139,92,246,0.08) 0%, transparent 50%);"></div>
    </div>

    <!-- Hero particle system (React island) -->
    <HeroParticles client:idle />

    <div class="relative z-10 text-center max-w-4xl mx-auto">
      <p class="text-sm font-medium tracking-[0.2em] uppercase text-[var(--color-accent-secondary)] mb-6">
        Open Standards for Neural Security
      </p>

      <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold font-[family-name:var(--font-heading)] tracking-tight mb-4 leading-[1.1]">
        <span class="bg-gradient-to-r from-[var(--color-accent-primary)] via-[var(--color-accent-secondary)] to-[var(--color-accent-tertiary)] bg-clip-text text-transparent">
          Quantum Indeterministic
        </span>
        <br />
        <span class="text-[var(--color-text-primary)]">Framework</span>
      </h1>

      <p class="text-lg sm:text-xl text-[var(--color-text-muted)] mb-8 max-w-2xl mx-auto leading-relaxed">
        The first open security standard for brain-computer interfaces. Bridging quantum physics, neuroscience, and cybersecurity into a unified defense model.
      </p>

      <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-8">
        <a
          href="https://mindloft.org"
          target="_blank"
          rel="noopener noreferrer"
          class="px-6 py-3 rounded-lg bg-[var(--color-accent-primary)] text-white font-medium hover:bg-[var(--color-accent-primary)]/90 transition-colors"
        >
          Read the Whitepaper
        </a>
        <a
          href="/framework/"
          class="px-6 py-3 rounded-lg glass text-[var(--color-text-primary)] font-medium hover:bg-white/10 transition-colors"
        >
          Explore the Framework
        </a>
      </div>

      <TrustBar />
    </div>

    <!-- Scroll indicator -->
    <div class="absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce">
      <svg class="w-5 h-5 text-[var(--color-text-faint)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
      </svg>
    </div>
  </section>

  <!-- ═══ THREE PILLARS ═══ -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24">
    <div class="text-center mb-12 reveal">
      <h2 class="text-3xl font-bold font-[family-name:var(--font-heading)] mb-4">Three Pillars</h2>
      <p class="text-[var(--color-text-muted)] max-w-2xl mx-auto">
        QIF defines the threats. NSP implements the protocol. Runemate compresses so post-quantum encryption costs nothing.
      </p>
    </div>

    <div class="grid md:grid-cols-3 gap-6 reveal reveal-stagger">
      {PILLARS.map((pillar) => (
        <a href={pillar.href} class="glass rounded-xl p-6 card-hover group">
          <div class="flex items-center gap-3 mb-4">
            <div class="text-2xl" style={`color: ${pillar.color}`} set:html={pillar.icon} />
            <span class="text-xs px-2 py-0.5 rounded-full border border-[var(--color-border)] text-[var(--color-text-faint)]">
              v{pillar.version} &middot; {pillar.status}
            </span>
          </div>
          <h3 class="text-lg font-semibold font-[family-name:var(--font-heading)] mb-1 group-hover:text-[var(--color-accent-primary)] transition-colors">
            {pillar.name}
          </h3>
          <p class="text-xs text-[var(--color-text-faint)] mb-3">{pillar.tagline}</p>
          <p class="text-sm text-[var(--color-text-muted)] leading-relaxed">
            {pillar.description}
          </p>
        </a>
      ))}
    </div>
  </section>

  <!-- ═══ HOURGLASS PREVIEW ═══ -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24">
    <div class="text-center mb-12 reveal">
      <h2 class="text-3xl font-bold font-[family-name:var(--font-heading)] mb-4">The Hourglass</h2>
      <p class="text-[var(--color-text-muted)] max-w-2xl mx-auto">
        7 bands in a 3-1-3 symmetric architecture. Physical interface at the waist.
      </p>
    </div>

    <!-- Static hourglass visualization (Three.js island will enhance) -->
    <div class="max-w-md mx-auto space-y-2 reveal reveal-stagger" id="hourglass-preview">
      {HOURGLASS_BANDS.map((band, i) => {
        const widths = [85, 75, 65, 50, 65, 75, 85];
        const width = widths[i];
        return (
          <div class="flex items-center gap-3 group cursor-pointer" title={band.description}>
            <span class="text-xs text-[var(--color-text-faint)] w-8 text-right font-mono">{band.id}</span>
            <div
              class="h-8 rounded-md flex items-center px-3 transition-all group-hover:scale-[1.02] group-hover:brightness-125"
              style={`width: ${width}%; background: ${band.color}20; border: 1px solid ${band.color}40; margin: 0 auto;`}
            >
              <span class="text-xs font-medium" style={`color: ${band.color}`}>{band.name}</span>
            </div>
          </div>
        );
      })}
    </div>

    <div class="text-center mt-8">
      <a href="/framework/" class="text-sm text-[var(--color-accent-primary)] hover:text-[var(--color-accent-secondary)] transition-colors">
        Explore the full interactive model &rarr;
      </a>
    </div>
  </section>

  <!-- ═══ LATEST PUBLICATIONS ═══ -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24">
    <div class="flex items-center justify-between mb-8 reveal">
      <h2 class="text-3xl font-bold font-[family-name:var(--font-heading)]">Latest Publications</h2>
      <a href="/publications/" class="text-sm text-[var(--color-accent-primary)] hover:text-[var(--color-accent-secondary)] transition-colors">
        View all &rarr;
      </a>
    </div>

    <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6 reveal reveal-stagger">
      {posts.map((post) => (
        <PublicationCard
          title={post.data.title}
          date={post.data.date_posted || post.data.date || new Date()}
          tags={post.data.tags}
          slug={post.id}
          body={post.body || ''}
        />
      ))}
    </div>
  </section>

  <!-- ═══ MINDLOFT CALLOUT ═══ -->
  <section class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-16 reveal">
    <div class="glass rounded-2xl p-8 sm:p-12 text-center">
      <p class="text-sm font-medium tracking-[0.15em] uppercase text-[var(--color-accent-tertiary)] mb-3">Tools &amp; Technology</p>
      <h2 class="text-2xl sm:text-3xl font-bold font-[family-name:var(--font-heading)] mb-4">Mindloft</h2>
      <p class="text-[var(--color-text-muted)] max-w-xl mx-auto mb-8 leading-relaxed">
        Interactive whitepaper, reference implementations, and BCI security tools built on QIF standards. Where the framework meets application.
      </p>
      <a
        href="https://mindloft.org"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 px-6 py-3 rounded-lg bg-[var(--color-accent-tertiary)]/10 text-[var(--color-accent-tertiary)] border border-[var(--color-accent-tertiary)]/20 font-medium hover:bg-[var(--color-accent-tertiary)]/20 transition-colors"
      >
        Visit mindloft.org
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
        </svg>
      </a>
    </div>
  </section>

  <Footer />
</BaseLayout>
