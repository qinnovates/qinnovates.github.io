---
import BaseLayout from './BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import { formatDate, cleanTag, readingTime } from '../lib/utils';
import '../styles/global.css';

interface Props {
  title: string;
  date: string | Date;
  tags: string[];
  source?: string;
  subtitle?: string;
}

const { title, date: rawDate, tags, source, subtitle } = Astro.props;
const date = rawDate instanceof Date ? rawDate : new Date(rawDate);
---

<BaseLayout title={title} description={subtitle || `${title} â€” Qinnovate Publications`}>
  <Nav />

  <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-16">
    <Breadcrumbs items={[
      { label: 'Publications', href: '/publications/' },
      { label: title },
    ]} />

    <!-- Article header -->
    <header class="mb-12">
      <h1 class="text-3xl sm:text-4xl font-bold font-[family-name:var(--font-heading)] leading-tight mb-4">
        {title}
      </h1>

      {subtitle && (
        <p class="text-lg text-[var(--color-text-muted)] mb-6 italic">{subtitle}</p>
      )}

      <div class="flex flex-wrap items-center gap-4 text-sm text-[var(--color-text-faint)]">
        <time datetime={date.toISOString()}>{formatDate(date.toISOString())}</time>
        {source && (
          <>
            <span>&middot;</span>
            <a href={source} target="_blank" rel="noopener noreferrer" class="hover:text-[var(--color-accent-primary)] transition-colors">
              Original source
            </a>
          </>
        )}
      </div>

      <div class="flex flex-wrap gap-2 mt-4">
        {tags.map((tag) => (
          <span class="text-xs px-2 py-1 rounded-full bg-[var(--color-bg-elevated)] text-[var(--color-text-muted)]">
            {cleanTag(tag)}
          </span>
        ))}
      </div>
    </header>

    <!-- Article body -->
    <div class="prose">
      <slot />
    </div>

    <!-- Article footer -->
    <footer class="mt-16 pt-8 border-t border-[var(--color-border)]">
      <a href="/publications/" class="text-sm text-[var(--color-accent-primary)] hover:text-[var(--color-accent-secondary)] transition-colors">
        &larr; All publications
      </a>
    </footer>
  </article>

  <Footer />
</BaseLayout>
